<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Programming the Agilex - Vollo SDK User Guide</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="assets/vollo-favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <a href="./">
                  <img class="sidebar-logo">
                  </img>
                </a>

                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="key-features.html"><strong aria-hidden="true">2.</strong> Key Features</a></li><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="vollo-compiler.html"><strong aria-hidden="true">4.</strong> Vollo Compiler</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">4.1.</strong> API Reference</a></li><li class="chapter-item expanded "><a href="supported-models.html"><strong aria-hidden="true">4.2.</strong> Supported Models</a></li><li class="chapter-item expanded "><a href="example-1-mlp.html"><strong aria-hidden="true">4.3.</strong> Example 1: MLP</a></li><li class="chapter-item expanded "><a href="example-2-cnn.html"><strong aria-hidden="true">4.4.</strong> Example 2: CNN</a></li><li class="chapter-item expanded "><a href="example-3-lstm.html"><strong aria-hidden="true">4.5.</strong> Example 3: LSTM</a></li><li class="chapter-item expanded "><a href="example-4-mixed-precision.html"><strong aria-hidden="true">4.6.</strong> Example 4: Mixed Precision</a></li><li class="chapter-item expanded "><a href="example-5-multi-model.html"><strong aria-hidden="true">4.7.</strong> Example 5: Multiple Models in a Vollo Program</a></li><li class="chapter-item expanded "><a href="vollo-onnx.html"><strong aria-hidden="true">4.8.</strong> ONNX Support</a></li></ol></li><li class="chapter-item expanded "><a href="benchmark.html"><strong aria-hidden="true">5.</strong> Benchmarks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="benchmark-mlp.html"><strong aria-hidden="true">5.1.</strong> MLP</a></li><li class="chapter-item expanded "><a href="benchmark-cnn.html"><strong aria-hidden="true">5.2.</strong> CNN</a></li><li class="chapter-item expanded "><a href="benchmark-lstm.html"><strong aria-hidden="true">5.3.</strong> LSTM</a></li><li class="chapter-item expanded "><a href="benchmark-io.html"><strong aria-hidden="true">5.4.</strong> IO Round Trip</a></li></ol></li><li class="chapter-item expanded "><a href="accelerator-setup.html"><strong aria-hidden="true">6.</strong> Accelerator Setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="system-requirements.html"><strong aria-hidden="true">6.1.</strong> System Requirements</a></li><li class="chapter-item expanded "><a href="programming-the-agilex.html" class="active"><strong aria-hidden="true">6.2.</strong> Programming the Agilex</a></li><li class="chapter-item expanded "><a href="programming-the-silicom-fb4CGg3.html"><strong aria-hidden="true">6.3.</strong> Programming the Silicom fb4CGg3</a></li><li class="chapter-item expanded "><a href="programming-the-v80.html"><strong aria-hidden="true">6.4.</strong> Programming the V80</a></li><li class="chapter-item expanded "><a href="licensing.html"><strong aria-hidden="true">6.5.</strong> Licensing</a></li><li class="chapter-item expanded "><a href="running-an-example.html"><strong aria-hidden="true">6.6.</strong> Running an Example</a></li><li class="chapter-item expanded "><a href="running-the-benchmark.html"><strong aria-hidden="true">6.7.</strong> Running the Benchmark</a></li></ol></li><li class="chapter-item expanded "><a href="vollo-runtime.html"><strong aria-hidden="true">7.</strong> Vollo Runtime</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="c-api.html"><strong aria-hidden="true">7.1.</strong> C API</a></li><li class="chapter-item expanded "><a href="vollo-rt-example.html"><strong aria-hidden="true">7.2.</strong> C Example</a></li><li class="chapter-item expanded "><a href="vollo-rt-python-example.html"><strong aria-hidden="true">7.3.</strong> Python Example</a></li></ol></li><li class="chapter-item expanded "><a href="ip-core/0-intro.html"><strong aria-hidden="true">8.</strong> Vollo IP Core</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ip-core/1-selecting-an-ip-core.html"><strong aria-hidden="true">8.1.</strong> Selecting an IP Core</a></li><li class="chapter-item expanded "><a href="ip-core/2-interface.html"><strong aria-hidden="true">8.2.</strong> IP Core Interface</a></li><li class="chapter-item expanded "><a href="ip-core/3-quartus-integration.html"><strong aria-hidden="true">8.3.</strong> Quartus Integration</a></li><li class="chapter-item expanded "><a href="ip-core/4-config.html"><strong aria-hidden="true">8.4.</strong> Runtime configuration</a></li><li class="chapter-item expanded "><a href="ip-core/5-example-design.html"><strong aria-hidden="true">8.5.</strong> Example design</a></li></ol></li><li class="chapter-item expanded "><a href="versions.html"><strong aria-hidden="true">9.</strong> Versions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="release-notes.html"><strong aria-hidden="true">9.1.</strong> Release Notes</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Vollo SDK User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="programming-the-agilex-fpga"><a class="header" href="#programming-the-agilex-fpga">Programming the Agilex FPGA</a></h1>
<h2 id="download-the-bitstream-for-your-fpga"><a class="header" href="#download-the-bitstream-for-your-fpga">Download the bitstream for your FPGA</a></h2>
<p>The bitstream is available on the <a href="https://github.com/MyrtleSoftware/vollo-sdk/releases/">Github Release page</a> alongside the Vollo SDK.
For example to download the bitstream for the Agilex <code>ia840f</code> board with the <code>c2b64d</code> configuration of Vollo:</p>
<pre><code class="language-sh">curl -LO https://github.com/MyrtleSoftware/vollo-sdk/releases/download/v26.0.1/vollo-ia840f-c2b64d-26.0.tar.gz
mkdir -p $VOLLO_SDK/bitstream
tar -xzf vollo-ia840f-c2b64d-26.0.tar.gz -C $VOLLO_SDK/bitstream
</code></pre>
<p>The Agilex-based boards that are currently supported are:</p>
<ul>
<li>
<p>Bittware IA420F</p>
</li>
<li>
<p>Bittware IA840F</p>
</li>
<li>
<p>Napatech NT400D11 (Link programmable version)</p>
</li>
</ul>
<h2 id="note-on-programming-the-napatech-nt400d11-over-jtag"><a class="header" href="#note-on-programming-the-napatech-nt400d11-over-jtag">Note on programming the Napatech NT400D11 over JTAG</a></h2>
<p>The NT400D11 card needs additional cabling beyond a USB cable to program the
board over JTAG. This cabling is provided as a development kit by Napatech
(PGM-DEVKIT-IFPGA-DF52-2XIDC-UART, product number: 802-0116-01-10) and includes:</p>
<ul>
<li>
<p>An IntelÂ® FPGA USB-Blaster II cable and,</p>
</li>
<li>
<p>A Napatech Passive FPGA Download Cable converter box</p>
</li>
</ul>
<p>These two cables must be connected to each other as shown in the image below:</p>
<p><img src="./assets/napatech-cables.png" alt="Intel JTAG and Napatech cables connected" /></p>
<p>To connect this cable array to the Napatech board, the long thin plug should be
connected to the connector shown in the following image:</p>
<p><img src="./assets/connector.png" alt="Connector J29 on the NT400D11" /></p>
<p>In order to correctly couple these two connectors, observe the conventions shown
in the following image:</p>
<p><img src="./assets/connector-pins.png" alt="Connector coupling conventions" /></p>
<p>Connector the USB side of the cable array to a high-speed USB port on your host PC
and the follow the rest of the directions in the next section.</p>
<h2 id="programming-the-fpga-via-jtag"><a class="header" href="#programming-the-fpga-via-jtag">Programming the FPGA via JTAG</a></h2>
<p>If your FPGA is not already programmed with the Vollo accelerator then please
follow these instructions to load the bitstream into the accelerator card's
flash memory.</p>
<p>This requires a USB cable to be connected to the accelerator card and Quartus
programmer to be installed on the system so that the device can be programmed
over JTAG.</p>
<p>If the FPGA card already has a Vollo Accelerator Bitstream, it can be updated
over PCIe by following the steps in the section <a href="#programming-the-fpga-via-pcie">Program the FPGA via
PCIe</a> below.
Note that you only need to update the bitstream if updating to an <a href="versions.html#version-compatibility">incompatible
version</a> of the Vollo SDK.
Programming over PCIe is faster than programming over JTAG, and does not
require a USB programming cable or for Quartus Programmer to be installed.</p>
<ol>
<li>
<p>Download and install the latest Quartus Programmer:</p>
<ul>
<li>Navigate to
<a href="https://www.intel.com/content/www/us/en/software-kit/782411/intel-quartus-prime-pro-edition-design-software-version-23-2-for-linux.html">https://www.intel.com/content/www/us/en/software-kit/782411/intel-quartus-prime-pro-edition-design-software-version-23-2-for-linux.html</a>.</li>
<li>Select <code>Additional Software</code> and scroll down to find the Programmer.</li>
<li>Follow the instructions for installation.</li>
</ul>
</li>
<li>
<p>Add Quartus programmer to your path:</p>
<pre><code class="language-sh">export QUARTUS_DIR=&lt;path to qprogrammer install&gt;
export PATH=$QUARTUS_DIR/qprogrammer/quartus/bin:$PATH
</code></pre>
</li>
<li>
<p>Start the jtag daemon:</p>
<pre><code class="language-sh">sudo killall jtagd
sudo jtagd
</code></pre>
</li>
<li>
<p>Run <code>jtagconfig</code> from the Quartus install, you should see the device(s):</p>
<pre><code class="language-sh">$ jtagconfig
1) IA-840F [1-5.2]
  0341B0DD   AGFB027R25A(.|R0)
</code></pre>
<p>or, for the NT400D11:</p>
<pre><code class="language-sh">$ jtagconfig
1) USB-BlasterII [1-5]
  C34320DD   AGFA014R24C(.|B|AA)
</code></pre>
</li>
<li>
<p>Navigate to the directory containing the <code>jic</code> file:</p>
<pre><code class="language-sh">source setup.sh
cd $VOLLO_SDK/bitstream
</code></pre>
</li>
<li>
<p>Set the JTAG clock frequency of the device you want to program to 16 MHz.
Specify the device by providing the name returned by <code>jtagconfig</code>:</p>
<pre><code class="language-sh">jtagconfig --setparam "IA-840F [1-5.2]" JtagClock 16M
</code></pre>
<p>or, for the NT400D11:</p>
<pre><code class="language-sh">jtagconfig --setparam "USB-BlasterII [1-5]" JtagClock 16M
</code></pre>
</li>
<li>
<p>Start the programming operation on the chosen device. This takes around 20
minutes. For the IA840F:</p>
<pre><code class="language-sh">quartus_pgm -c "IA-840F [1-5.2]" -m JTAG -o "ipv;vollo-ia840f-c3b64.jic"
</code></pre>
<p>or, for the IA420F:</p>
<pre><code class="language-sh">quartus_pgm -c "IA-420F [1-5.2]" -m JTAG -o "ipv;vollo-ia420f-c6b32.jic"
</code></pre>
<p>or, for the NT400D11:</p>
<pre><code class="language-sh">quartus_pgm -c "USB-BlasterII [1-5]" -m JTAG -o "ipv;vollo-nt400d1-c6b32.jic"
</code></pre>
</li>
<li>
<p>Go back to 6 and program any other devices.</p>
</li>
<li>
<p>Power off the system and start it back up. The bitstream will now be loaded
onto the FPGA.</p>
<div class="warning">
For the configuration process to be triggered the board has to register the power being off. It
is recommended to turn the power off and then wait a few seconds before turning the power back
on to ensure this happens.
</div>
</li>
<li>
<p>Check a Vollo bitstream is loaded:</p>
<pre><code class="language-sh">$ lspci -d 1ed9:766f
51:00.0 Processing accelerators: Myrtle.ai Device 766f (rev 01)
</code></pre>
<p>Check the correct Vollo bitstream is loaded:</p>
<pre><code class="language-sh">vollo-tool bitstream-check bitstream/&lt;bitstream-name&gt;.json
</code></pre>
</li>
</ol>
<h2 id="programming-the-fpga-via-pcie"><a class="header" href="#programming-the-fpga-via-pcie">Programming the FPGA via PCIe</a></h2>
<p>NOTE: this can only be done with an FPGA that is already programmed with a Vollo bitstream.</p>
<ol>
<li>
<p>Load the kernel driver:</p>
<pre><code class="language-sh">sudo ./load-kernel-driver.sh
</code></pre>
</li>
<li>
<p>Check the current bitstream information:</p>
<pre><code class="language-sh">source setup.sh
vollo-tool bitstream-info
</code></pre>
</li>
<li>
<p>Check that the device is set up for remote system updates by running the
command below, with <code>device index</code> representing the index of the device you
want to update, in the order shown in the previous command, starting from 0.
It should print a <code>json</code> string to the terminal showing the device status.</p>
<pre><code class="language-sh">vollo-tool fpga-config rsu-status &lt;device index&gt;
</code></pre>
</li>
<li>
<p>Update the <code>USER_IMAGE</code> partition of the flash with the new bitstream image
contained in the <code>rpd</code> archive in the <code>$VOLLO_SDK/bitstream</code> directory. This should take
around 5 minutes. Do not interrupt this process until it completes.</p>
<pre><code class="language-sh">sudo ./load-kernel-driver.sh
vollo-tool fpga-config overwrite-partition &lt;device index&gt; &lt;.rpd.tar.gz file&gt; USER_IMAGE
</code></pre>
</li>
<li>
<p>Repeat step 4 for any other devices you wish to update.</p>
</li>
<li>
<p>Power off the system and start it back up.</p>
<div class="warning">
For the configuration process to be triggered the board has to register the power being off. It
is recommended to turn the power off and then wait a few seconds before turning the power back on
to ensure this happens.
</div>
</li>
<li>
<p>Repeat steps 1, 2 and 3. The <code>bitstream-info</code> command should show that the
updated bitstream has been loaded (e.g. a newer release date), and the output
of the <code>rsu-status</code> command should show all zeroes for the <code>error_code</code> and
<code>failing_image_address</code> fields.</p>
</li>
<li>
<p>Check the correct Vollo bitstream is loaded:</p>
<pre><code class="language-sh">sudo ./load-kernel-driver.sh
vollo-tool bitstream-check bitstream/&lt;bitstream-name&gt;.json
</code></pre>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="system-requirements.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="programming-the-silicom-fb4CGg3.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="system-requirements.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="programming-the-silicom-fb4CGg3.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
